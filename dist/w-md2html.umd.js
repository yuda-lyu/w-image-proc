/*!
 * w-md2html v1.0.1
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("fs"),require("sharp")):"function"==typeof define&&define.amd?define(["fs","sharp"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-md2html"]=e(t.fs,t.sharp)}(this,function(t,e){"use strict";var r=Array.isArray,n="object"==typeof global&&global&&global.Object===Object&&global,o="object"==typeof self&&self&&self.Object===Object&&self,u=n||o||Function("return this")(),i=u.Symbol,c=Object.prototype,a=c.hasOwnProperty,f=c.toString,l=i?i.toStringTag:void 0;var s=Object.prototype.toString;var p=i?i.toStringTag:void 0;function b(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":p&&p in Object(t)?function(t){var e=a.call(t,l),r=t[l];try{t[l]=void 0;var n=!0}catch(t){}var o=f.call(t);return n&&(e?t[l]=r:delete t[l]),o}(t):function(t){return s.call(t)}(t)}function h(t){return null!=t&&"object"==typeof t}function y(t){return"symbol"==typeof t||h(t)&&"[object Symbol]"==b(t)}var d=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,v=/^\w*$/;function g(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function j(t){if(!g(t))return!1;var e=b(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var _,m=u["__core-js_shared__"],w=(_=/[^.]+$/.exec(m&&m.keys&&m.keys.IE_PROTO||""))?"Symbol(src)_1."+_:"";var O=Function.prototype.toString;function A(t){if(null!=t){try{return O.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var S=/^\[object .+?Constructor\]$/,x=Function.prototype,z=Object.prototype,E=x.toString,F=z.hasOwnProperty,P=RegExp("^"+E.call(F).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function $(t){return!(!g(t)||(e=t,w&&w in e))&&(j(t)?P:S).test(A(t));var e}function R(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return $(r)?r:void 0}var T=R(Object,"create");var B=Object.prototype.hasOwnProperty;var I=Object.prototype.hasOwnProperty;function U(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function M(t,e){return t===e||t!=t&&e!=e}function k(t,e){for(var r=t.length;r--;)if(M(t[r][0],e))return r;return-1}U.prototype.clear=function(){this.__data__=T?T(null):{},this.size=0},U.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},U.prototype.get=function(t){var e=this.__data__;if(T){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return B.call(e,t)?e[t]:void 0},U.prototype.has=function(t){var e=this.__data__;return T?void 0!==e[t]:I.call(e,t)},U.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=T&&void 0===e?"__lodash_hash_undefined__":e,this};var G=Array.prototype.splice;function N(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}N.prototype.clear=function(){this.__data__=[],this.size=0},N.prototype.delete=function(t){var e=this.__data__,r=k(e,t);return!(r<0)&&(r==e.length-1?e.pop():G.call(e,r,1),--this.size,!0)},N.prototype.get=function(t){var e=this.__data__,r=k(e,t);return r<0?void 0:e[r][1]},N.prototype.has=function(t){return k(this.__data__,t)>-1},N.prototype.set=function(t,e){var r=this.__data__,n=k(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var W=R(u,"Map");function D(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function L(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}L.prototype.clear=function(){this.size=0,this.__data__={hash:new U,map:new(W||N),string:new U}},L.prototype.delete=function(t){var e=D(this,t).delete(t);return this.size-=e?1:0,e},L.prototype.get=function(t){return D(this,t).get(t)},L.prototype.has=function(t){return D(this,t).has(t)},L.prototype.set=function(t,e){var r=D(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function q(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],u=r.cache;if(u.has(o))return u.get(o);var i=t.apply(this,n);return r.cache=u.set(o,i)||u,i};return r.cache=new(q.Cache||L),r}q.Cache=L;var C,H,V,Q=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,J=/\\(\\)?/g,K=(C=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Q,function(t,r,n,o){e.push(n?o.replace(J,"$1"):r||t)}),e},H=q(C,function(t){return 500===V.size&&V.clear(),t}),V=H.cache,H),X=K;var Y=i?i.prototype:void 0,Z=Y?Y.toString:void 0;function tt(t){if("string"==typeof t)return t;if(r(t))return function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(t,tt)+"";if(y(t))return Z?Z.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function et(t){return null==t?"":tt(t)}function rt(t,e){return r(t)?t:function(t,e){if(r(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!y(t))||v.test(t)||!d.test(t)||null!=e&&t in Object(e)}(t,e)?[t]:X(et(t))}function nt(t){if("string"==typeof t||y(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function ot(t,e,r){var n=null==t?void 0:function(t,e){for(var r=0,n=(e=rt(e,t)).length;null!=t&&r<n;)t=t[nt(e[r++])];return r&&r==n?t:void 0}(t,e);return void 0===n?r:n}function ut(t){return et(t).toLowerCase()}function it(t){var e=this.__data__=new N(t);this.size=e.size}it.prototype.clear=function(){this.__data__=new N,this.size=0},it.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},it.prototype.get=function(t){return this.__data__.get(t)},it.prototype.has=function(t){return this.__data__.has(t)},it.prototype.set=function(t,e){var r=this.__data__;if(r instanceof N){var n=r.__data__;if(!W||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new L(n)}return r.set(t,e),this.size=r.size,this};var ct=function(){try{var t=R(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),at=ct;function ft(t,e,r){"__proto__"==e&&at?at(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var lt=Object.prototype.hasOwnProperty;function st(t,e,r){var n=t[e];lt.call(t,e)&&M(n,r)&&(void 0!==r||e in t)||ft(t,e,r)}function pt(t,e,r,n){var o=!r;r||(r={});for(var u=-1,i=e.length;++u<i;){var c=e[u],a=n?n(r[c],t[c],c,r,t):void 0;void 0===a&&(a=t[c]),o?ft(r,c,a):st(r,c,a)}return r}function bt(t){return h(t)&&"[object Arguments]"==b(t)}var ht=Object.prototype,yt=ht.hasOwnProperty,dt=ht.propertyIsEnumerable,vt=bt(function(){return arguments}())?bt:function(t){return h(t)&&yt.call(t,"callee")&&!dt.call(t,"callee")},gt=vt;var jt="object"==typeof exports&&exports&&!exports.nodeType&&exports,_t=jt&&"object"==typeof module&&module&&!module.nodeType&&module,mt=_t&&_t.exports===jt?u.Buffer:void 0,wt=(mt?mt.isBuffer:void 0)||function(){return!1},Ot=/^(?:0|[1-9]\d*)$/;function At(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&Ot.test(t))&&t>-1&&t%1==0&&t<e}function St(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}var xt={};function zt(t){return function(e){return t(e)}}xt["[object Float32Array]"]=xt["[object Float64Array]"]=xt["[object Int8Array]"]=xt["[object Int16Array]"]=xt["[object Int32Array]"]=xt["[object Uint8Array]"]=xt["[object Uint8ClampedArray]"]=xt["[object Uint16Array]"]=xt["[object Uint32Array]"]=!0,xt["[object Arguments]"]=xt["[object Array]"]=xt["[object ArrayBuffer]"]=xt["[object Boolean]"]=xt["[object DataView]"]=xt["[object Date]"]=xt["[object Error]"]=xt["[object Function]"]=xt["[object Map]"]=xt["[object Number]"]=xt["[object Object]"]=xt["[object RegExp]"]=xt["[object Set]"]=xt["[object String]"]=xt["[object WeakMap]"]=!1;var Et="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ft=Et&&"object"==typeof module&&module&&!module.nodeType&&module,Pt=Ft&&Ft.exports===Et&&n.process,$t=function(){try{var t=Ft&&Ft.require&&Ft.require("util").types;return t||Pt&&Pt.binding&&Pt.binding("util")}catch(t){}}(),Rt=$t&&$t.isTypedArray,Tt=Rt?zt(Rt):function(t){return h(t)&&St(t.length)&&!!xt[b(t)]},Bt=Object.prototype.hasOwnProperty;function It(t,e){var n=r(t),o=!n&&gt(t),u=!n&&!o&&wt(t),i=!n&&!o&&!u&&Tt(t),c=n||o||u||i,a=c?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],f=a.length;for(var l in t)!e&&!Bt.call(t,l)||c&&("length"==l||u&&("offset"==l||"parent"==l)||i&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||At(l,f))||a.push(l);return a}var Ut=Object.prototype;function Mt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ut)}function kt(t,e){return function(r){return t(e(r))}}var Gt=kt(Object.keys,Object),Nt=Object.prototype.hasOwnProperty;function Wt(t){if(!Mt(t))return Gt(t);var e=[];for(var r in Object(t))Nt.call(t,r)&&"constructor"!=r&&e.push(r);return e}function Dt(t){return null!=t&&St(t.length)&&!j(t)}function Lt(t){return Dt(t)?It(t):Wt(t)}var qt=Object.prototype.hasOwnProperty;function Ct(t){if(!g(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=Mt(t),r=[];for(var n in t)("constructor"!=n||!e&&qt.call(t,n))&&r.push(n);return r}function Ht(t){return Dt(t)?It(t,!0):Ct(t)}var Vt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Qt=Vt&&"object"==typeof module&&module&&!module.nodeType&&module,Jt=Qt&&Qt.exports===Vt?u.Buffer:void 0,Kt=Jt?Jt.allocUnsafe:void 0;function Xt(){return[]}var Yt=Object.prototype.propertyIsEnumerable,Zt=Object.getOwnPropertySymbols,te=Zt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,u=[];++r<n;){var i=t[r];e(i,r,t)&&(u[o++]=i)}return u}(Zt(t),function(e){return Yt.call(t,e)}))}:Xt,ee=te;function re(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}var ne=kt(Object.getPrototypeOf,Object),oe=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)re(e,ee(t)),t=ne(t);return e}:Xt,ue=oe;function ie(t,e,n){var o=e(t);return r(t)?o:re(o,n(t))}function ce(t){return ie(t,Lt,ee)}function ae(t){return ie(t,Ht,ue)}var fe=R(u,"DataView"),le=R(u,"Promise"),se=R(u,"Set"),pe=R(u,"WeakMap"),be="[object Map]",he="[object Promise]",ye="[object Set]",de="[object WeakMap]",ve="[object DataView]",ge=A(fe),je=A(W),_e=A(le),me=A(se),we=A(pe),Oe=b;(fe&&Oe(new fe(new ArrayBuffer(1)))!=ve||W&&Oe(new W)!=be||le&&Oe(le.resolve())!=he||se&&Oe(new se)!=ye||pe&&Oe(new pe)!=de)&&(Oe=function(t){var e=b(t),r="[object Object]"==e?t.constructor:void 0,n=r?A(r):"";if(n)switch(n){case ge:return ve;case je:return be;case _e:return he;case me:return ye;case we:return de}return e});var Ae=Oe,Se=Object.prototype.hasOwnProperty;var xe=u.Uint8Array;function ze(t){var e=new t.constructor(t.byteLength);return new xe(e).set(new xe(t)),e}var Ee=/\w*$/;var Fe=i?i.prototype:void 0,Pe=Fe?Fe.valueOf:void 0;function $e(t,e,r){var n,o=t.constructor;switch(e){case"[object ArrayBuffer]":return ze(t);case"[object Boolean]":case"[object Date]":return new o(+t);case"[object DataView]":return function(t,e){var r=e?ze(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(t,e){var r=e?ze(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}(t,r);case"[object Map]":case"[object Set]":return new o;case"[object Number]":case"[object String]":return new o(t);case"[object RegExp]":return function(t){var e=new t.constructor(t.source,Ee.exec(t));return e.lastIndex=t.lastIndex,e}(t);case"[object Symbol]":return n=t,Pe?Object(Pe.call(n)):{}}}var Re=Object.create,Te=function(){function t(){}return function(e){if(!g(e))return{};if(Re)return Re(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),Be=Te;var Ie=$t&&$t.isMap,Ue=Ie?zt(Ie):function(t){return h(t)&&"[object Map]"==Ae(t)};var Me=$t&&$t.isSet,ke=Me?zt(Me):function(t){return h(t)&&"[object Set]"==Ae(t)},Ge="[object Arguments]",Ne="[object Function]",We="[object Object]",De={};function Le(t,e,n,o,u,i){var c,a=1&e,f=2&e,l=4&e;if(n&&(c=u?n(t,o,u,i):n(t)),void 0!==c)return c;if(!g(t))return t;var s=r(t);if(s){if(c=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&Se.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t),!a)return function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}(t,c)}else{var p=Ae(t),b=p==Ne||"[object GeneratorFunction]"==p;if(wt(t))return function(t,e){if(e)return t.slice();var r=t.length,n=Kt?Kt(r):new t.constructor(r);return t.copy(n),n}(t,a);if(p==We||p==Ge||b&&!u){if(c=f||b?{}:function(t){return"function"!=typeof t.constructor||Mt(t)?{}:Be(ne(t))}(t),!a)return f?function(t,e){return pt(t,ue(t),e)}(t,function(t,e){return t&&pt(e,Ht(e),t)}(c,t)):function(t,e){return pt(t,ee(t),e)}(t,function(t,e){return t&&pt(e,Lt(e),t)}(c,t))}else{if(!De[p])return u?t:{};c=$e(t,p,a)}}i||(i=new it);var h=i.get(t);if(h)return h;i.set(t,c),ke(t)?t.forEach(function(r){c.add(Le(r,e,n,r,t,i))}):Ue(t)&&t.forEach(function(r,o){c.set(o,Le(r,e,n,o,t,i))});var y=s?void 0:(l?f?ae:ce:f?Ht:Lt)(t);return function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););}(y||t,function(r,o){y&&(r=t[o=r]),st(c,o,Le(r,e,n,o,t,i))}),c}De[Ge]=De["[object Array]"]=De["[object ArrayBuffer]"]=De["[object DataView]"]=De["[object Boolean]"]=De["[object Date]"]=De["[object Float32Array]"]=De["[object Float64Array]"]=De["[object Int8Array]"]=De["[object Int16Array]"]=De["[object Int32Array]"]=De["[object Map]"]=De["[object Number]"]=De[We]=De["[object RegExp]"]=De["[object Set]"]=De["[object String]"]=De["[object Symbol]"]=De["[object Uint8Array]"]=De["[object Uint8ClampedArray]"]=De["[object Uint16Array]"]=De["[object Uint32Array]"]=!0,De["[object Error]"]=De[Ne]=De["[object WeakMap]"]=!1;function qe(t){return Le(t,5)}function Ce(t){return!(!function(t){return"[object String]"===Object.prototype.toString.call(t)}(t)||""===t)}function He(t){let e=!1;if(Ce(t))e=!isNaN(Number(t));else if(function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)){if(function(t){return t!=t}(t))return!1;e=!0}return e}function Ve(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}function Qe(t){return!0===(e=t)||!1===e||h(e)&&"[object Boolean]"==b(e);var e}function Je(t){let e,r=Object.prototype.toString.call(t);if(e="[object Promise]"===r,e)return!0;if("[object Function]"!==r)return!1;try{e="function"!=typeof t.subscribe&&"function"==typeof t.then}catch(t){}return e}var Ke=/\s/;var Xe=/^\s+/;function Ye(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&Ke.test(t.charAt(e)););return e}(t)+1).replace(Xe,""):t}var Ze=/^[-+]0x[0-9a-f]+$/i,tr=/^0b[01]+$/i,er=/^0o[0-7]+$/i,rr=parseInt;function nr(t){if("number"==typeof t)return t;if(y(t))return NaN;if(g(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=g(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ye(t);var r=tr.test(t);return r||er.test(t)?rr(t.slice(2),r?2:8):Ze.test(t)?NaN:+t}var or=1/0;function ur(t){return t?(t=nr(t))===or||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function ir(t){var e=ur(t),r=e%1;return e==e?r?e-r:e:0}var cr=u.isFinite,ar=Math.min;var fr=function(t){var e=Math[t];return function(t,r){if(t=nr(t),(r=null==r?0:ar(ir(r),292))&&cr(t)){var n=(et(t)+"e").split("e");return+((n=(et(e(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round"),lr=fr;function sr(t){if(!He(t))return 0;return ur(t)}function pr(t){if(!He(t))return 0;t=sr(t);let e=lr(t);return"0"===String(e)?0:e}function br(t,e){return r=t,"[object Object]"===Object.prototype.toString.call(r)&&(!(!Ce(e)&&!He(e))&&e in t);var r}function hr(t,e,r){var n=t.length;return r=void 0===r?n:r,!e&&r>=n?t:function(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(r=r>o?o:r)<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var u=Array(o);++n<o;)u[n]=t[n+e];return u}(t,e,r)}var yr=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");function dr(t){return yr.test(t)}var vr=$t&&$t.isRegExp,gr=vr?zt(vr):function(t){return h(t)&&"[object RegExp]"==b(t)};var jr="\\ud800-\\udfff",_r="["+jr+"]",mr="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",wr="\\ud83c[\\udffb-\\udfff]",Or="[^"+jr+"]",Ar="(?:\\ud83c[\\udde6-\\uddff]){2}",Sr="[\\ud800-\\udbff][\\udc00-\\udfff]",xr="(?:"+mr+"|"+wr+")"+"?",zr="[\\ufe0e\\ufe0f]?",Er=zr+xr+("(?:\\u200d(?:"+[Or,Ar,Sr].join("|")+")"+zr+xr+")*"),Fr="(?:"+[Or+mr+"?",mr,Ar,Sr,_r].join("|")+")",Pr=RegExp(wr+"(?="+wr+")|"+Fr+Er,"g");function $r(t){return dr(t)?function(t){return t.match(Pr)||[]}(t):function(t){return t.split("")}(t)}function Rr(t,e,r){return r&&"number"!=typeof r&&function(t,e,r){if(!g(r))return!1;var n=typeof e;return!!("number"==n?Dt(r)&&At(e,r.length):"string"==n&&e in r)&&M(r[e],t)}(t,e,r)&&(e=r=void 0),(r=void 0===r?4294967295:r>>>0)?(t=et(t))&&("string"==typeof e||null!=e&&!gr(e))&&!(e=tt(e))&&dr(t)?hr($r(t),0,r):t.split(e,r):[]}var Tr,Br=(Tr="length",function(t){return null==t?void 0:t[Tr]}),Ir="\\ud800-\\udfff",Ur="["+Ir+"]",Mr="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",kr="\\ud83c[\\udffb-\\udfff]",Gr="[^"+Ir+"]",Nr="(?:\\ud83c[\\udde6-\\uddff]){2}",Wr="[\\ud800-\\udbff][\\udc00-\\udfff]",Dr="(?:"+Mr+"|"+kr+")"+"?",Lr="[\\ufe0e\\ufe0f]?",qr=Lr+Dr+("(?:\\u200d(?:"+[Gr,Nr,Wr].join("|")+")"+Lr+Dr+")*"),Cr="(?:"+[Gr+Mr+"?",Mr,Nr,Wr,Ur].join("|")+")",Hr=RegExp(kr+"(?="+kr+")|"+Cr+qr,"g");function Vr(t){return dr(t)?function(t){for(var e=Hr.lastIndex=0;Hr.test(t);)++e;return e}(t):Br(t)}function Qr(t){if(null==t)return 0;if(Dt(t))return"string"==typeof(e=t)||!r(e)&&h(e)&&"[object String]"==b(e)?Vr(t):t.length;var e,n=Ae(t);return"[object Map]"==n||"[object Set]"==n?t.size:Wt(t).length}function Jr(t){return!!He(t)&&(t=sr(t),"number"==typeof(e=t)&&e==ir(e));var e}function Kr(t){if(!Jr(t))return!1;return pr(t)>=0}function Xr(t,e){if(!Ce(t))return"";if(!Kr(e))return"";if(0===(e=pr(e)))return"";let r=t.length-e;return r<0&&(r=0),t.substring(r,r+e)}function Yr(t,e){return Ce(t)&&Kr(e)?0===(e=pr(e))?t:function(t,e){return Ce(t)&&Kr(e)?0===(e=pr(e))?"":t.substring(0,e):""}(t,t.length-e):""}function Zr(t){if(!Ce(t))return"";let e=function(t){if(!Ce(t))return{path:"",isRoot:!1};for(;t.indexOf("\\\\")>=0;)t=t.replace("\\\\","\\");for(;t.indexOf("//")>=0;)t=t.replace("//","/");if(":"===Xr(t,1))return{path:`${t}\\`,isRoot:!0};if("\\"===Xr(t,1)){let e=Yr(t,1);return":"===Xr(e,1)?{path:t,isRoot:!0}:{path:e,isRoot:!1}}if("/"===Xr(t,1)){let e=Yr(t,1);return 0===e.length?{path:t,isRoot:!0}:{path:e,isRoot:!1}}return{path:t,isRoot:!1}}(t);if(e.isRoot)return e.path;let r=e.path;try{r=r.split("\\").pop().split("/").pop()}catch(t){}return r}function tn(e){return function(t,e={}){let r=ot(e,"fs");return!!r.existsSync(t)&&!r.lstatSync(t).isDirectory()&&!r.lstatSync(t).isSymbolicLink()}(e,{fs:t})}let en=(t,e)=>{let r=t.toString("base64"),n=(t=>"png"===(t=ut(t))?"image/png":"jpg"===t||"jpeg"===t?"image/jpeg":"gif"===t?"image/gif":"svg"===t?"image/svg+xml":"webp"===t?"image/webp":"application/octet-stream")(e);return`data:${n};base64,${r}`},rn=async(r,n,o={})=>{if(!tn(r))throw new Error(`fpInp[${r}] does not exist`);let u=ot(o,"funGetWidth"),i=ot(o,"funGetHeight"),c=ot(o,"funGetSize"),a=ot(o,"cropLeft"),f=ot(o,"cropTop"),l=ot(o,"cropWidth"),s=ot(o,"cropHeight"),p=ot(o,"density");He(p)||(p=96),p=pr(p);let b=ot(o,"returnBase64");Qe(b)||(b=!1);let h=function(t){if(!Ce(t))return"";let e=Rr(Zr(t),".");if(Qr(e)<=1)return"";let r="";try{r=(o=null==(n=e)?0:n.length)?n[o-1]:void 0}catch(t){}var n,o;return r}(n);h=ut(h);let y=t.readFileSync(r),d=null,v=null;if(Ve(c)||Ve(u)||Ve(i)){let t=await e(y).metadata();if(Ve(c)){let e=c(qe(t));if(Je(e)&&(e=await e),!He(ot(e,"width")))throw new Error("invalid ret.width for funGetSize");if(!He(ot(e,"height")))throw new Error("invalid ret.height for funGetSize");d=pr(e.width),v=pr(e.height)}else Ve(u)?(d=u(qe(t)),Je(d)&&(d=await d),d=pr(d)):Ve(i)&&(v=i(qe(t)),Je(v)&&(v=await v),v=pr(v))}let g=await e(y,{density:p}),j=He(d),_=He(v),m=He(a)&&He(f)&&He(l)&&He(s);j&&_?g=g.resize({width:d,height:v,withoutEnlargement:!0}):j&&!_?g=g.resize({width:d,withoutEnlargement:!0}):!j&&_&&(g=g.resize({height:v,withoutEnlargement:!0})),m&&(a=pr(a),f=pr(f),l=pr(l),s=pr(s),g=g.extract({left:a,top:f,width:l,height:s}));let w={png:()=>g.png({compressionLevel:9,adaptiveFiltering:!1,palette:!1,quality:100,colors:256,...o}),jpg:()=>g.flatten({background:ot(o,"background","#fff")}).jpeg({quality:100,progressive:!1,chromaSubsampling:"4:2:0",optimiseCoding:!0,mozjpeg:!1,overshootDeringing:!1,...o}),jpeg:()=>g.flatten({background:ot(o,"background","#fff")}).jpeg({quality:100,progressive:!1,chromaSubsampling:"4:2:0",optimiseCoding:!0,mozjpeg:!1,overshootDeringing:!1,...o}),webp:()=>g.webp({quality:100,alphaQuality:100,lossless:!0,...o}),avif:()=>g.avif({quality:50,lossless:!1,speed:5,chromaSubsampling:"4:2:0",...o}),gif:()=>g.gif({effort:7,interlace:!1,...o}),tiff:()=>g.tiff({quality:100,compression:"jpeg",predictor:"horizontal",pyramid:!1,tile:!1,...o}),bmp:()=>g.bmp({...o})};g=br(w,h)?w[h]():g.toFormat(h);let O=await g.toBuffer();if(b){return en(O,h)}return t.writeFileSync(n,O),"ok"};return{proc:rn,convert:async(t,e,r={})=>{let n={...r,cropLeft:null,cropTop:null,cropWidth:null,cropHeight:null,funGetWidth:null,funGetHeight:null,funGetSize:null,returnBase64:!1};return await rn(t,e,n)},resize:async(t,e,r={})=>{let n={...r,cropLeft:null,cropTop:null,cropWidth:null,cropHeight:null,returnBase64:!1};return await rn(t,e,n)},crop:async(t,e,r,n,o,u,i={})=>{let c={...i,cropLeft:e,cropTop:r,cropWidth:n,cropHeight:o,funGetWidth:null,funGetHeight:null,funGetSize:null,returnBase64:!1};return await rn(t,u,c)},base64:async(t,e,r={})=>{let n={...r,cropLeft:null,cropTop:null,cropWidth:null,cropHeight:null,returnBase64:!0};return await rn(t,`${t}.${e}`,n)}}});
//# sourceMappingURL=w-md2html.umd.js.map
